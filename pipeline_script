pipeline {
    agent any

    stages {
        stage ('QA_Deploy') {
            steps {
              withCredentials([
                string(credentialsId: 'secret_webuser', variable: 'SECRETUSER'),
                string(credentialsId: 'secret_webhost', variable: 'SECRETHOST'),
                string(credentialsId: 'secret_profilekey', variable: 'SECRETKEY')
              ]){
                  sh 'ls -lrt | egrep -v "^d|list\$|^total" | sed "s#^.* ##" | while read f; do scp -p -i ${SECRETKEY} $f ${SECRETUSER}@${SECRETHOST}:/home/ar4jf2nz/public_html/qa; done'

                  println "... executing QA deployment stage"
              }
            }
        }
        stage ('QA_Test') {
            steps {
                println "... executing QA test stage: (1) test home page and (2) test referenced links"
            }
        }
        stage ('PROD_Deploy') {
            steps {
                sh 'echo "... printing list of files from github"'
                sh 'ls -lrt'
                println "... if QA test stage succeeds, executing PROD deployment stage"
            }
        }
        stage ('Report_Valid_Files') {
            steps {
                println "... if PROD deployment succeeds, executing report valid files stage"
            }
        }
        stage ('Report_Obsolete_Files') {
            steps {
                println "... executing report obsolete files stage"
            }
        }
    }
}
